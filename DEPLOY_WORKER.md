Cloudflare Worker Deployment (api.artwalls.space)

Prereqs
- Cloudflare CLI: `npm i -g wrangler` or use `npx wrangler`
- Logged in: `wrangler whoami` shows your account and permissions
- DNS: `api.artwalls.space` proxied through Cloudflare and in the same zone

Secrets (required)
Run these in the `worker/` directory so they attach to the Worker script defined there.
- `npx wrangler secret put SUPABASE_SERVICE_ROLE_KEY`
- `npx wrangler secret put STRIPE_SECRET_KEY`
- `npx wrangler secret put STRIPE_WEBHOOK_SECRET`
- `npx wrangler secret put TWILIO_ACCOUNT_SID`
- `npx wrangler secret put TWILIO_AUTH_TOKEN`
- `npx wrangler secret put TWILIO_FROM_NUMBER`

Deploy
1) Change into the worker folder: `cd worker`
2) Verify config: `cat wrangler.toml` (should show `main = "index.ts"` and the `routes` for api.artwalls.space)
3) Deploy: `npx wrangler deploy`

Verify
- Root: `curl -i https://api.artwalls.space/` → `Artwalls API OK`
- Health: `curl -s https://api.artwalls.space/api/health` → `{ "ok": true }`
- Env: `curl -s https://api.artwalls.space/api/env/check` → booleans for envs
- Listings:
  - `curl -s "https://api.artwalls.space/api/artists?city=Portland"`
  - `curl -s "https://api.artwalls.space/api/venues?cities=Portland,Seattle"`

Supabase Migration (cities)
- Apply: run the SQL in `supabase/migrations/008_city_recommendations.sql` against your database
- Confirm columns exist: `artists.city_primary`, `artists.city_secondary`, `venues.city`

Pages (frontend)
- Pages config lives at root in `wrangler.json`
- Deploy the Vite app with: `npx wrangler pages deploy dist` after `npm run build`

Notes
- The Worker returns CORS headers for `https://artwalls.space` in all responses.
- Purchase URLs generated by the Worker point to `https://artwalls.space/#/purchase-<artworkId>`.
- If you get "Workers command in a Pages project" errors, deploy from the `worker/` folder.
